name: Run Appium C# Tests

on:
  push:
    branches:
      - master

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    services:
      appium:
        image: appium/appium
        ports:
          - 4723:4723
        options: --privileged

    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4

    - name: âš™ï¸ Set up .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '7.0.x'

    - name: ğŸ§± Install Java & Android dependencies
      uses: reactivecircus/android-emulator-runner@v2
      with:
        api-level: 30
        target: default
        arch: x86_64
        profile: pixel
        script: echo "Emulator will start later..."

    - name: ğŸ“¦ Restore NuGet packages
      run: dotnet restore

    - name: ğŸ› ï¸ Build the solution
      run: dotnet build --configuration Release

    - name: ğŸ“² Start Android Emulator (ARM Image)
      uses: reactivecircus/android-emulator-runner@v2
      with:
        api-level: 30
        target: default
        arch: arm64-v8a # <- use ARM-based image
        profile: pixel
        emulator-options: -no-window -no-audio -no-snapshot
        disable-animations: true


    - name: ğŸš€ Run Appium Tests
      env:
        APPIUM_HOST: http://127.0.0.1:4723
      run: |
        echo "Running tests..."
        dotnet test --logger "console;verbosity=detailed"
